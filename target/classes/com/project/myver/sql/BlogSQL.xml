<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"HTTP://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="blog">

	<!-- 'blog'table ========================================================== -->
	<!-- 21.05.03 블로그 생성 -->
	<insert id="insertBlog" parameterType="blogDTO">
		INSERT INTO blog (member_no, blog_title, blog_nick)
		VALUES (#{member_no}, #{blog_title}, #{blog_nick})
	</insert>
	
	<!-- 21.05.19 블로그 홈에서 보일 'member_no'에 해당하는 블로그 정보 -->
	<select id="selectBlogHomeDataFromBlog" parameterType="Integer" resultType="blogDTO">
		SELECT blog_no, blog_nick, blog_img_no
		FROM blog
		WHERE member_no = #{member_no}
	</select>
	
	<!-- 21.05.19 'member_no'로 블로그 정보 가져오기 -->
	<select id="selectAllFromBlog" parameterType="Integer" resultType="blogDTO">
		SELECT * 
		FROM blog 
		WHERE member_no = #{member_no}
	</select>
	
	<!-- 21.05.25 'member_no'로 블로그 이웃 정보 가져오기 (blog_title, blog_nick, blog_img_no) -->
	<select id="selectBlog_titleAndNickAndImg_noFromBlog" parameterType="Integer" resultType="blogDTO">
		SELECT blog_title, blog_nick, blog_img_no 
		FROM blog 
		WHERE member_no = #{member_no}
	</select>
	
	
	<!-- 'blog_visit'table ==================================================================== -->
	<!-- 21.05.19 'blog_no'에 해당하는 블로그 오늘 방문자수 -->
	<select id="todayBlogVisitCount" parameterType="Integer" resultType="Integer">
		SELECT COUNT(blog_visit_no)
		FROM blog_visit
		WHERE blog_no = #{blog_no}
			AND DATE_FORMAT(DATE, "%Y-%m-%d") = CURDATE()
	</select>
	
	
	<!-- 'blog_category'table ================================================================ -->
	<!-- 21.05.23 카테고리 리스트 가져오기 -->
	<select id="selectAllFromBlog_category" parameterType="Integer" resultType="blogDTO">
		SELECT * 
		FROM blog_category 
		WHERE blog_no = #{blog_no} 
		ORDER BY category_index
		
	</select>
	
	
	<!-- 'blog_neighbor'table ================================================================== -->
	<!-- 21.05.24 내가 추가한 이웃 리스트 가져오기 -->
	<select id="selectFollowingListFromBlog_neighbor" parameterType="Integer" resultType="blogDTO">
		SELECT neighbor_member_no 
		FROM blog_neighbor 
		WHERE member_no = #{member_no}
	</select>
	
	<!-- 21.05.24 나를 추가한 이웃 리스트 가져오기 -->
	<select id="selectFollowerListFromBlog_neighbor" parameterType="Integer" resultType="blogDTO">
		SELECT member_no 
		FROM blog_neighbor
		WHERE neighbor_member_no = #{member_no}
	</select>
	
	
	<!-- 'blog_object'table =================================================================== -->
	<!-- 21.05.27 블로그 글 테이블에서 'blog_category_no'에 해당하는 개수 가져오기 -->
	<select id="selectTotalCountFromBlog_object" parameterType="Integer" resultType="Integer">
		SELECT COUNT(blog_object_no) 
		FROM blog_object 
		WHERE blog_category_no = #{blog_category_no}
	</select>
	
	<!-- 21.05.27 목록 가져오기 -->
	<select id="selectListDetailFromBlog_object" parameterType="pageUtil" resultType="blogDTO">
		SELECT @ROWNUM := @ROWNUM + 1 AS ROWNUM, TB.*
  		FROM (SELECT blog_object_no, title, DATE, is_public, hits
          	  FROM blog_object
          	  WHERE blog_category_no = #{blog_cateogry_no}
              ORDER BY blog_object_no DESC) AS TB
      		, (SELECT @ROWNUM := 0) AS RN
 		LIMIT #{startNo}, #{endNo}
	</select>
	
	<!-- 21.05.27 게시글 내용 가져오기 -->
	<select id="selectObjectDetailFromBlog_object" parameterType="pageUtil" resultType="blogDTO">
		SELECT @ROWNUM := @ROWNUM + 1 AS ROWNUM, TB.*
  		FROM (SELECT blog_object_no, title, content, DATE, is_public, hits, likes
          	  FROM blog_object
          	  WHERE blog_category_no = #{blog_cateogry_no}
              ORDER BY blog_object_no DESC) AS TB
      		, (SELECT @ROWNUM := 0) AS RN
 		LIMIT #{startNo}, #{endNo}
	</select>
	
	
</mapper>
	
